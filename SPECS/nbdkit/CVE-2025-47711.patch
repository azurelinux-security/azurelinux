From 3b485f7a5925a53e57cca816a48c09e68cef5355 Mon Sep 17 00:00:00 2001
From: Azure Linux Security Servicing Account
 <azurelinux-security@microsoft.com>
Date: Wed, 2 Jul 2025 08:47:02 +0000
Subject: [PATCH] Fix CVE CVE-2025-47711 in nbdkit

Upstream Patch Reference: https://gitlab.com/nbdkit/nbdkit/-/commit/c3c1950867ea8d9c2108ff066ed9e78dde3cfc3f.patch
---
 server/protocol.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/server/protocol.c b/server/protocol.c
index d9a5e28..c32fec8 100644
--- a/server/protocol.c
+++ b/server/protocol.c
@@ -493,7 +493,7 @@ extents_to_block_descriptors (struct nbdkit_extents *extents,
       (*nr_blocks)++;
 
       pos += length;
-      if (pos > offset + count) /* this must be the last block */
+      if (pos >= offset + count) /* this must be the last block */
         break;
 
       /* If we reach here then we must have consumed this whole
-- 
2.45.3

